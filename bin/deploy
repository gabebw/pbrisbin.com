#!/usr/bin/env sh
source "${0%/*}/utils.sh"

set -e

tag="v$(date +%Y%m%d%H%M)"

jekyll build

ssh "$host" "cp -a '$directory' '$backups/pre-$tag'" &&
  printf "backup complete: %s/%s\n" "$backups" "pre-$tag"

rsync -e ssh --archive _site/ "$host:$directory/"

git tag -s -m "$tag" "$tag"

printf "success: %s -> %s\n" "$tag" "$host"
printf "pushing to github...\n"

git push
git push --tags
