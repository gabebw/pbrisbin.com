#!/usr/bin/env sh
source "${0%/*}/utils.sh"

[ $# -eq 0 ] && die "usage: new [--lhs] <Title of the Post>"

if [ "$1" = '--lhs' ]; then
  shift
  extension='lhs'
else
  extension='md'
fi

title="$*"
draft="_drafts/$(printf "$title" | sed 's/.*/\L&/; s/ \+/_/g').$extension"

[ -e "$draft" ] && die "$draft exists."

cat > "$draft" <<EOF
---
layout: post
title: "$title"
tags:
  - TODO
  - TODO
---

EOF

if vim "$draft" +'normal Go'; then
  printf "%s\n" "$draft"
else
  rm -v "$draft"
fi
